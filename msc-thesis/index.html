<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF Auto Scroll Loop</title>
  <style>
    html, body { height: 100%; margin: 0; background: #111; }
    #wrap {
      height: 100vh;
      overflow: auto;
      scroll-behavior: smooth;
      padding: 16px 0 60vh;
    }
    canvas {
      display: block;
      margin: 0 auto 16px;
      background: #000;
      border-radius: 8px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>
  <div id="wrap"><div id="viewer"></div></div>

  <!-- PDF.js as ES module -->
  <script type="module">
    import * as pdfjsLib from
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.mjs";

    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";

    // -------- CONFIG --------
    const PDF_URL = "https://coderodde.github.io/msc-thesis.pdf";
    const SCALE = 1.25;
    const SPEED_PX_PER_SEC = 70;
    const WRAP_PAUSE_MS = 800;
    // ------------------------

    const wrap = document.getElementById("wrap");
    const viewer = document.getElementById("viewer");

    async function renderAllPages(url) {
      const pdf = await pdfjsLib.getDocument(url).promise;

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: SCALE });

        const canvas = document.createElement("canvas");
        canvas.width = Math.floor(viewport.width);
        canvas.height = Math.floor(viewport.height);

        const ctx = canvas.getContext("2d", { alpha: false });
        viewer.appendChild(canvas);

        await page.render({ canvasContext: ctx, viewport }).promise;
      }
    }

    function startLoopingAutoScroll() {
      let last = null;
      let wrapping = false;

      function tick(ts) {
        if (last === null) last = ts;
        const dt = (ts - last) / 1000;
        last = ts;

        const maxScroll = wrap.scrollHeight - wrap.clientHeight;

        if (!wrapping) {
          const next = wrap.scrollTop + SPEED_PX_PER_SEC * dt;

          if (next >= maxScroll - 1) {
            wrap.scrollTop = maxScroll;
            wrapping = true;

            setTimeout(() => {
              wrap.scrollTop = 0;
              last = null;
              wrapping = false;
              requestAnimationFrame(tick);
            }, WRAP_PAUSE_MS);
            return;
          } else {
            wrap.scrollTop = next;
          }
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    }

    await renderAllPages(PDF_URL);
    startLoopingAutoScroll();
  </script>
</body>
</html>
